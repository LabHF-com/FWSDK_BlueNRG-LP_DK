<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-LP/LPS Bluetooth Low Energy Stack: BlueNRG-BLE Stack Library v_3_1b (17-March-2023)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-LP/LPS Bluetooth Low Energy Stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlueNRG-BLE Stack Library v_3_1b (17-March-2023) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="S1"></a>
Bluetooth Low Energy (LE) stack binary image files</h1>
<p>This section lists the Bluetooth LE Stack Library binary file to be used for the BlueNRG-LP/BlueNRG-LPS Systems On Chip configuration: <br />
</p>
<ul>
<li>libbluenrglp_stack.a binary library <b>v3.1b</b> with following main features: <ul>
<li>
Bluetooth LE 5.x specifications </li>
<li>
Direction Findings (AoA, AoD) [supported only on BlueNRG-LPS device] </li>
<li>
LE Data Packet Length Extension </li>
<li>
LE Secure Connections </li>
<li>
Link Layer Privacy </li>
<li>
2Mbps PHY </li>
<li>
LE Long Range (Coded PHY) </li>
<li>
High Duty Cycle Non-Connectable Advertising </li>
<li>
Extended advertising and scanning </li>
<li>
LE Channel Selection Algorithm #2 </li>
<li>
GATT Robust Caching </li>
<li>
Periodic Advertising and Periodic Advertising Sync Transfer </li>
<li>
LE Ping procedure </li>
<li>
LE L2CAP Connection-Oriented Channel support </li>
<li>
LE Power Control &amp; Path Loss Monitoring support </li>
<li>
Connection robustness mechanism: <ul>
<li>
It allows to tolerate delayed execution of Radio ISR by skipping connection events but not dropping the connection.</li>
</ul>
</li>
<li>
Multiple/concurrent active links supported (tested up to 24) </li>
<li>
Link statistics </li>
<li>
New GATT layer framework and updated commands/events interface: <ul>
<li>
It allows to handle GATT attributes values directly into user application, leaving to the Bluetooth LE library the ownership of data-transfer only.</li>
</ul>
</li>
<li>
New GAP layer APIs for advertising, scanning and connection procedures </li>
<li>
Support and integration of the new Timer module external to Bluetooth LE Library </li>
<li>
Support and integration of the new NVM module external to to Bluetooth LE Library </li>
<li>
ATT Maximum Transmission Unit (MTU) size is 1020 octets. </li>
<li>
L2CAP Maximum Payload Size (MPS) size is 1024 octets. </li>
<li>
MISRA-C:2012 compliance </li>
<li>
Bluetooth LE stack modular configurations allowing to optimize Bluetooth LE stack memory footprints based on user application scenario. <ul>
<li>
<b> Added new modular configuration option (CONNECTION_ENABLED) for allowing to enable/disable the connection capability </b>: <ul>
<li>
If connection option is disabled, connections are not supported; device is a broadcaster only if master capability option is disabled, or a broadcaster and observer only if master capability option is enabled. </li>
<li>
If connection option is enabled, connections are supported; device can only act as broadcaster or peripheral if master capability option is disabled, or any role (broadcaster, observer, peripheral, and central) if master capability option is enabled. </li>
</ul>
</li>
<li>
This option allows to improve Bluetooth LE FLASH memory footprint for applications scenarios not requesting connection capabilities.</li>
</ul>
</li>
</ul>
</li>
<li><b>NOTES</b>: <ul>
<li>
libbluenrg_lp_stack.a binary library file <b>v3.1b</b> is available in folder: <b>Middlewares\ST\Bluetooth_LE\Library</b>. The binary file must be linked to the built user application in order to get access to the Bluetooth LE stack features. </li>
<li>
libbluenrg_lp_stack.a is valid for the following supported toolchains: IAR-EWARM, ARM Keil MDK. </li>
<li>
When adding libbluenrg_lp_stack.a on a Keil project, just change the related File Type to Library File (from file Options). </li>
<li>
Configuration files stack_user_cfg.[c/h] are used for enabling the Bluetooth LE stack v3.x modular approach </li>
<li>
AES CMAC encryption functionality required by Bluetooth LE stack v3.x is available on new standalone binary library: Middlewares\ST\cryptolib\cryptolib.a </li>
<li>
Vendor Specific Error Codes values have been updated in order to align to new BLE Standard Error Codes added by BLE Specifications v.5.2: <ul>
<li>
All ST BlueNRG-BLE Stack Library v2.x error codes from value 0x40 have been shifted forward, starting from value 0x80. </li>
<li>
The new values are defined in the ble_status.h file </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="S10"></a>
Bluetooth LE stack modular configurations options</h2>
<ul>
<li>Some predefined sets of <b>BlueNRG-BLE Stack Library</b> modular configurations options are available: <ol>
<li>
<b> BLE_STACK_FULL_CONF </b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain, for configuring the Bluetooth LE stack with all supported modular features: <ul>
<li>
Controller Privacy is enabled </li>
<li>
LE Secure Connection is enabled </li>
<li>
Master role is enabled </li>
<li>
Data length extension is enabled </li>
<li>
LE 2M PHY, LE CODED PHY are enabled </li>
<li>
Extended Advertising is enabled </li>
<li>
LE L2CAP Connection-Oriented Channels is enabled </li>
<li>
Periodic advertising and sync transfer is enabled </li>
<li>
Constant Tone Extension is enabled (where applicable: not supported on BlueNRG-LP device) </li>
<li>
LE Power Control is enabled </li>
<li>
Connection capability is enabled</li>
</ul>
</li>
<li>
<b>BLE_STACK_BASIC_CONF</b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain for configuring the Bluetooth LE stack with the basic configuration options: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connection is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is disabled </li>
<li>
LE 2M PHY, LE CODED PHY are disabled </li>
<li>
Extended Advertising is disabled </li>
<li>
LE L2CAP Connection-Oriented Channels is disabled </li>
<li>
Periodic advertising and sync transfer is disabled </li>
<li>
Constant Tone Extension is disabled </li>
<li>
LE Power Control is disabled </li>
<li>
Connection capability is enabled</li>
</ul>
</li>
<li>
<b>BLE_STACK_SLAVE_DLE_CONF </b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain for selecting the OTA Service support with Data length extension: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connections is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is enabled </li>
<li>
LE 2M PHY and LE CODED PHY are disabled </li>
<li>
Extended Advertising is disabled </li>
<li>
LE L2CAP Connection-Oriented Channels is disabled </li>
<li>
Periodic advertising and sync transfer is disabled </li>
<li>
Constant Tone Extension is disabled </li>
<li>
LE Power Control is disabled </li>
<li>
Connection capability is enabled</li>
</ul>
</li>
</ol>
</li>
<li>NOTES: <ul>
<li>
Files stack_user_cfg.[c/h] must not be modified by user. </li>
<li>
<b>BLE_STACK_CUSTOM_CONF</b> option is also available for allowing user to define specific set of Bluetooth LE modular configuration options on a dedicated header file:<ul>
<li>
"custom_ble_stack_conf.h" to be placed on user demonstration application Inc folder. This allows user to select only the Bluetooth LE features required for the specific application scenario, and to optimize the application memory footprints.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S11"></a>
Bluetooth Low Energy (LE) stack network coprocessor configuration</h1>
<ul>
<li>The following network coprocessor modes are supported when using BlueNRG GUI and DTM application: UART (mainly for RF evaluation purpose) and SPI. </li>
<li>DTM project and related workspaces provides reference applications for configuring the BlueNRG-LP/BlueNRG-LPS platforms as a network coprocessor (refer to BlueNRG-LP DK Release notes documentation for more information).</li>
</ul>
<h1><a class="anchor" id="S12"></a>
New Features</h1>
<p>This section lists the new features compared to previous Bluetooth LE Stack Library<br />
</p>
<ul>
<li>ID 1024508: Add a command to explicitly disable/enable peripheral latency (aci_hal_peripheral_latency_enable()) </li>
<li>ID 1140336: Decrease punishment time intervals used by SMP repeated attempts protection (i.e. SMP rejectlist, ex blacklist)</li>
</ul>
<ul>
<li>NOTES: <ul>
<li>
Refer to <a href="../BlueNRG-LP_BLE_stacks_migration/index.html">Bluetooth LE Stack v2.x to v3.x migration guideline html documentation </a> for information about how to port an application from BLE stack v2.x to v3.x and later. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S13"></a>
Solved Issues</h1>
<p>This section lists the solved issues compared to previous Bluetooth LE Stack Library</p>
<ul>
<li>ID 1021798: Disconnection if start encryption request received just before data length update. (LLC) </li>
<li>ID 1053178: Double free packet when invalid Exchange Configuration response packet is received. (GATT) </li>
<li>ID 1055406: Periodic advertising sync ends abnormally (radio deadlock). (LLC) </li>
<li>ID 1063184: When the extended advertising feature is disabled with CONTROLLER_EXT_ADV_SCAN_ENABLED macro, the number of advertising sets is not forced to be only one, possibly causing a memory corruption. (LLC) </li>
<li>ID 1074082: If a peer initiates two control procedures that are not supported by the device, the first procedure is rejected but no response is given to the second one. (LLC) </li>
<li>ID 1076664: Attribute handle returned in ACI_GATT_CLT_DISC_READ_CHAR_BY_UUID_RESP_EVENT is truncated: most significant byte is 0x00. (GATT) </li>
<li>ID 1104941: Random value used for OOB pairing is not initialized (default is 0), leading to a potential bypassing of Bluetooth Low Energy Secure Connections authentication. (SMP) </li>
<li>ID 1122643: Pairing fails (timeout) when peer device chooses not to exchange transport specific keys. (SMP) </li>
<li>ID 1130632: Force Rebond failure (DHKey Check error) when peer uses a Resolvable Private Address. (SMP) </li>
<li>ID 1142100: An invalid resolved address 0xFFFFFFFFFFFF can be reported in LE Extended Advertising Report event. This address can also be accepted to create a connection with a Peripheral. (LLC) </li>
<li>ID 1143356: Automatic CFC policy for L2CAP COS channels does not consider the case of peer transmitter that sends segments of size much smaller than MPS. (L2CAP) </li>
<li>ID 1025108: BT Core Erratum #16187 about L2CAP MPS definition/requirements of MPS (potential interperability issue). </li>
<li>ID 1002509: In a Multiple Handle Value Notification last Handle Length Value Tuple could be truncated. This is not allowed by spec. (GATT) </li>
<li>ID 1010200: Identity address is used in TargetA field of AUX_CONNECT_RSP (instead of a resolvable private address) after receiving an AUX_CONNECT_REQ with an RPA in the InitA field. (LLC) </li>
<li>ID 1073020: Check on avertising data length may fail in some particular cases. (LLC) </li>
<li>ID 1075785: In periodic advertising, the channel index of AUX_CHAIN_IND can be set outside the range of values limited by the current channel map. (LLC) </li>
<li>ID 1109666: No error is returned to the Client if the bits of a Client Characteristic Configuration Descriptor are not set according to characterisitic properties. (GATT) </li>
<li>ID 694231: If device is connected in Peripheral Role, HCI_LE_CONNECTION_UPDATE returns status 0x01 (Unknown Connection Identifier) instead of 0x0C (Command Disallowed). (LLC)</li>
</ul>
<h1><a class="anchor" id="S14"></a>
Limitations/Bugs</h1>
<p>This section lists the issues known at firmware image release time. Issues found after this release are listed as solved or limitations on newer releases. <br />
</p>
<ul>
<li>ID 600131: HCI timeout on ACI_GAP_CLEAR_SECURITY_DB command: <ul>
<li>
Erasing the SDB through the aci_gap_clear_security_db command shall be avoided during intense radio activities (meaning also when a connection is active). </li>
</ul>
</li>
<li>ID 611316: No error returned if the ACI_GAP_SET_SCAN_CONFIGURATION command is issued with LE_Scan_Window &gt; LE_Scan_Interval (an "invalid configuration" error is returned once the Scan procedure is started). </li>
<li>ID 974202: Wrong data reported when ExtendedHeaderLength are less than right value </li>
<li>ID 987581: HCI_LE_START_ENCRYPTION could take longer to return in some particular scenarios. </li>
<li>ID 1150976: A Link Layer procedure timeout happens on any new link if a certain number of connections are simultaneously active. This number is 22 if periodic advertising feature is included, 32 otherwise.</li>
</ul>
<h1><a class="anchor" id="S15"></a>
Documentation</h1>
<ul>
<li>Refer to <a href="../BlueNRG-LP_aci_events/files.html">Bluetooth Low Energy (LE) API and events html documentation </a> for detailed description of Bluetooth LE stack APIs and related events callbacks. </li>
<li>Refer to <a href="../BlueNRG-LP_BLE_stacks_migration/index.html">Bluetooth LE stack migration guidelines from v2.x to v3.x html documentation </a> for guidelines about how to migrate applications from Bluetooth low energy stack v2.x to v3.x.</li>
</ul>
<h1><a class="anchor" id="S16"></a>
BLE stack Flash memory footprints (bytes)</h1>
<ul>
<li><b>BLE stack full Flash size (all APIs and events used)</b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Full Stack Size  </th></tr>
<tr>
<td><b> V3.0 </b> </td><td>124.11 KB  </td></tr>
<tr>
<td><b> V3.1 </b> </td><td>144.9 KB  </td></tr>
<tr>
<td><b> V3.1a </b> </td><td>144.9 KB  </td></tr>
<tr>
<td><b> V3.1b </b> </td><td>145.8 KB   </td></tr>
</table>
<ul>
<li><b>BLE Sensor Demo application (BlueNRG-LP case): only BLE stack components Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Release </th><th>LowerApp_OTA </th><th>HigherApp_OTA </th><th>Use_OTA_ServiceManager </th></tr>
<tr>
<td><b> V3.0</b> </td><td>62.2 KB (1) </td><td>64.08 KB (2) </td><td>64.08 KB (2) </td><td>62.2 KB (1) </td></tr>
<tr>
<td><b> V3.1</b> </td><td>62.4 KB (1) </td><td>64.10 KB (2) </td><td>64.10 KB (2) </td><td>62.2 KB (1) </td></tr>
<tr>
<td><b> V3.1a </b> </td><td>61.7 KB (1) </td><td>63.4 KB (2) </td><td>63.4 KB (2) </td><td>61.7 KB (1) </td></tr>
<tr>
<td><b> V3.1b </b> </td><td>61.9 KB (1) </td><td>63.6 KB (2) </td><td>63.6 KB (2) </td><td>61.9 KB (1)  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ol>
<li>
BASIC stack configuration </li>
<li>
BASIC stack + extended data length configuration </li>
</ol>
</li>
</ul>
<ul>
<li><b>BLE Beacon application (BlueNRG-LP case): only BLE stack components Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Release </th></tr>
<tr>
<td><b> V3.0 (BASIC stack Configuration) </b> </td><td>62.12 KB (1) </td></tr>
<tr>
<td><b> V3.1 (BASIC stack Configuration) </b> </td><td>62.17 KB (1) </td></tr>
<tr>
<td><b> V3.1a (CUSTOM stack Configuration) </b> </td><td>16.09 KB (2) </td></tr>
<tr>
<td><b> V3.1b (CUSTOM stack Configuration) </b> </td><td>16.11 KB (2)  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ol>
<li>
On Bluetooth LE stack V3.0 and V3.1 BASIC stack configuration is used: connection capability is enabled by default and it cannot be turned OFF. </li>
<li>
On Bluetooth LE stack V3.1a/b, CUSTOM stack configuration allows to set new CONNECTION_ENABLED option to 0 (connection capability is turned OFF). </li>
</ol>
</li>
</ul>
<ul>
<li><b> OTA Service Manager: total application Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version/(device) </th><th>BASIC stack + extended data length configuration </th></tr>
<tr>
<td><b> V3.0 (BlueNRG-LP) </b> </td><td>90 KB </td></tr>
<tr>
<td><b> V3.1 (BlueNRG-LP) </b> </td><td>94 KB </td></tr>
<tr>
<td><b> V3.1a/b (BlueNRG-LP/BlueNRG-LPS)</b> </td><td>94 KB  </td></tr>
</table>
<h1><a class="anchor" id="S164"></a>
BLE Throughput</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>Unidirectional (ATT_MTU size = 23; no Data Length Extension) </th><th>Bidirectional (ATT_MTU size = 23; no Data Length Extension)  </th><th>Unidirectional (ATT_MTU size = 247; Data Length Extension = 251 on Peripheral side)  </th><th>Bidirectional (ATT_MTU size = 247; Data Length Extension = 251 on both Peripheral and Central sides) </th></tr>
<tr>
<td><b> 1Mbps PHY </b> </td><td>~220 kbps </td><td>~166 kbps  </td><td>~740 kbps  </td><td>~390 kbps  </td></tr>
<tr>
<td><b> 2Mbps PHY </b> </td><td>~317 kbps </td><td>~260 kbps  </td><td>~1367 kbps  </td><td>~783 kbps   </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
Unidirectional: GAP Peripheral performs characteristic notification to GAP Central. </li>
<li>
Bidirectional: GAP Peripheral performs characteristic notification to GAP Central and GAP Central performs characteristic write without response to GAP Peripheral. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2023 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
